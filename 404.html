<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>TreeBuilder</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="TreeBuilder.styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="_content/Telerik.UI.for.Blazor/css/kendo-theme-default/all.css" />
    <script src="_content/Telerik.UI.for.Blazor/js/telerik-blazor.js" defer></script>
    <script src="https://kit.fontawesome.com/e6ee6eb207.js" crossorigin="anonymous"></script>
</head>

<body>
    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>
        
        /*
            There is a chrome bug where if the DOM is updated during a drag event, the event will 
            be cancelled and DragEnd will be called unexpectedly. In order to get around this,
            the modification to the DOM needs to be done in a setTimeout(function,0) call. This
            following code is responsible for showing and unshowing additional slots by manipulating
            the CSS tags of the HTML elements directly. 
            
            Called from .NET via JSInterop.                   
         */
        
        function ToggleSlots(domid,on){
            setTimeout(() => {
                console.debug("ToggleSlots domid:" + domid + " on:" + on);
                if(domid == -1)
                    return;
                var item = document.getElementById(domid);
                item = item.getElementsByClassName("InterfaceSlots")[0];
                Right = item.children.Right;
                RightTop = item.children.RightTop;
                RightBottom = item.children.RightBottom;
                
                var numActive = RightTop.children.length + Right.children.length + RightBottom.children.length;
                
                // Show as many as possible
                if(on == true && numActive >= 1){
                    RightTop.setAttribute("class","tb-integrationslot");
                    RightBottom.setAttribute("class","tb-integrationslot");
                    Right.setAttribute("class","tb-integrationslot");
                } else if(Right.children.length == 0 && on == true && numActive >= 1){
                    if(RightTop.children.length == 0){
                        RightTop.setAttribute("class","tb-integrationslot tb-hidden");
                    }
                    if(RightBottom.children.length == 0) {
                        RightBottom.setAttribute("class", "tb-integrationslot tb-hidden");
                    }
                    Right.setAttribute("class","tb-integrationslot tb-hidden");
                } else if(on == true && numActive == 0){
                    RightTop.setAttribute("class","tb-integrationslot tb-hidden");
                    RightBottom.setAttribute("class","tb-integrationslot tb-hidden");
                    Right.setAttribute("class","tb-integrationslot");
                }
                
                // Hide as many as possible
                if(on == false){
                    if(RightTop.children.length == 0){
                        RightTop.setAttribute("class","tb-integrationslot tb-hidden");
                    }
                    if(RightBottom.children.length == 0){
                        RightBottom.setAttribute("class","tb-integrationslot tb-hidden");
                    }
                    if(numActive == 0){
                        // if none
                        Right.setAttribute("class","tb-integrationslot");
                    } else if(Right.children.length == 0 && numActive >= 1){
                        Right.setAttribute("class","tb-integrationslot tb-hidden");
                    }
                    
                    
                }
                
            },0);
        }
        
        var dotNetRef;
        
        function UpdateTitleHelper(ref){
            dotNetRef = ref;
        }
        
        function HandleOnFocus(e){
            console.log("onfocus fired: " + e);
        }

        /*
            Calls UpdateTitle from .NET when Title div loses focus
         */
        function HandleOnBlur(e){
            console.log("onblur fired: " + e);
            var str = e.innerText.trim().replace(/(\r\n|\n|\r)/gm, "");
            console.log(str);
            dotNetRef.invokeMethodAsync('UpdateTitle',str,e.id);
            e.removeAttribute("contenteditable");
        }
        
    </script>
</body>

</html>
